@model GrupoMad.Models.Product

@{
    ViewData["Title"] = "Gestionar Colores";
    var availableColors = ViewBag.AvailableColors as List<GrupoMad.Models.Color>;
}

<h1>Gestionar Colores - @Model.Name</h1>
<h5 class="text-muted">SKU: @Model.SKU</h5>

<hr />

<div class="row">
    <!-- Colores asignados -->
    <div class="col-md-6">
        <h3>Colores Asignados</h3>

        @if (Model.ProductColors != null && Model.ProductColors.Any())
        {
            <div class="list-group">
                @foreach (var pc in Model.ProductColors)
                {
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>@pc.Color.Name</strong><br />
                            <small class="text-muted">Código: @pc.Color.Code</small>
                        </div>
                        <form asp-action="RemoveColor" method="post" style="display: inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="productId" value="@Model.Id" />
                            <input type="hidden" name="colorId" value="@pc.Color.Id" />
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('¿Eliminar este color?');">
                                Eliminar
                            </button>
                        </form>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="alert alert-info">
                No hay colores asignados a este producto.
            </div>
        }
    </div>

    <!-- Colores disponibles para agregar -->
    <div class="col-md-6">
        <h3>Agregar Colores</h3>

        @{
            var assignedColorIds = Model.ProductColors?.Select(pc => pc.ColorId).ToList() ?? new List<int>();
            var colorsToAdd = availableColors?.Where(c => !assignedColorIds.Contains(c.Id)).ToList();
        }

        @if (colorsToAdd != null && colorsToAdd.Any())
        {
            <div class="list-group">
                @foreach (var color in colorsToAdd)
                {
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>@color.Name</strong><br />
                            <small class="text-muted">Código: @color.Code</small>
                        </div>
                        <form asp-action="AddColor" method="post" style="display: inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="productId" value="@Model.Id" />
                            <input type="hidden" name="colorId" value="@color.Id" />
                            <button type="submit" class="btn btn-sm btn-success">
                                Agregar
                            </button>
                        </form>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="alert alert-success">
                Todos los colores disponibles ya están asignados a este producto.
            </div>
        }
    </div>
</div>

<hr />
<div>
    <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-info">Ver Detalles</a>
    <a asp-action="Index" class="btn btn-secondary">Volver a la Lista</a>
</div>
